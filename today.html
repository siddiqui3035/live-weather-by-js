<x-app-layout>
    @section('title', $title)
    @section('content')
        <div class="main_content_iner overly_inner ">
            <div class="container-fluid p-0 ">
                <div class="row">
                    <div class="col-12">
                        <div class="page_title_box d-flex flex-wrap align-items-center justify-content-between">
                            <div class="page_title_left d-flex align-items-center">
                                <h3 class="f_s_25 f_w_700 dark_text mr_30">{{ $pageText }}</h3>
                            </div>
                            <div class="page_title_right">
                                <div class="page_date_button d-flex align-items-center">
                                    <img src="{{ asset('img/icon/calender_icon.svg') }}" alt="">
                                    {{ date('g:i a, l, M d Y') }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="white_card card_height_100 mb_30">
                            <div class="white_card_header">
                                @include('returns._month-year', [$responseYear, $responseMonth])
                            </div>
                            <div class="white_card_body">
                                <div class="row justify-content-bettwin table-responsive">
                                    <div class="col-lg-12">
                                        <div class="text-center mt-3">
                                            <h4 class="text-center">জেলা কেন্দ্রীয় সমবায় সমিতি (ইউসিসিএ) এর অডিট ফি আদায়
                                                অগ্রগতির মাসিক রিটার্ন</h4>
                                            <h5 class="text-center">{{ get_auth_user_office_name(true) }}</h5>
                                            <h5 class="text-center">
                                                মাসঃ {{ get_month_name($responseMonth) }},
                                                {{ get_number_in_bangla($responseYear) }}
                                            </h5>
                                        </div>
                                        <hr>
                                    </div>
                                </div>
                                <div id="table-wrapper">
                                    <div class="justify-content-bettwin table-responsive">
                                        <h5 class="text-center">ছকঃ ০১</h5>
                                        <h4 class="font-weight-bold">(লক্ষ টাকায়)</h4>
                                        <table class="table-bordered text-center w-100">
                                            <thead>
                                                <tr>
                                                    <th rowspan="2">ক্রঃনং</th>
                                                    <th rowspan="2">উপজেলা</th>
                                                    <th rowspan="2">ইউসিসিএ এর নাম</th>
                                                    <th colspan="3">ধার্যকৃত অডিট ফি</th>
                                                    <th colspan="3">চলতি মাস পর্যন্ত আদায়ের পরিমাণ</th>
                                                    <th colspan="3">মওকুফকৃত অডিট ফি এর পরিমাণ</th>
                                                    <th colspan="3">অনাদায়ী অডিট ফি এর পরিমাণ</th>
                                                    <th rowspan="2">সংশোধনী</th>
                                                </tr>
                                                <tr>
                                                    <td>হাল</td>
                                                    <td>বকেয়া</td>
                                                    <td>মোট</td>
                                                    <td>হাল</td>
                                                    <td>বকেয়া</td>
                                                    <td>মোট</td>
                                                    <td>হাল</td>
                                                    <td>বকেয়া</td>
                                                    <td>মোট</td>
                                                    <td>হাল</td>
                                                    <td>বকেয়া</td>
                                                    <td>মোট</td>
                                                </tr>
                                                <tr>
                                                    <td>১</td>
                                                    <td>২</td>
                                                    <td>৩</td>
                                                    <td>৪</td>
                                                    <td>৫</td>
                                                    <td>৬</td>
                                                    <td>৭</td>
                                                    <td>৮</td>
                                                    <td>৯</td>
                                                    <td>১০</td>
                                                    <td>১১</td>
                                                    <td>১২</td>
                                                    <td>১৩</td>
                                                    <td>১৪</td>
                                                    <td>১৫</td>
                                                    <td>-</td>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach ($divisionsData as $id => $divisionData)
                                                    <tr data-sl="">
                                                        <td class="text-center">{{ $loop->iteration }}</td>
                                                        <td class="text-center">{{ $divisionData['name'] }}</td>
                                                        <td class="text-center">
                                                            {{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['cooperatives'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['ass_h'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['ass_d'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldSix'] : '' }}
                                                        </td>

                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['rec_h'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['rec_d'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldNine'] : '' }}
                                                        </td>

                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['waiver_h'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['waiver_d'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldTwelve'] : '' }}
                                                        </td>

                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldThirteen'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldFourteen'] : '' }}
                                                        </td>
                                                        <td>{{ isset($divisionData['data']) ? $divisionData['data']['uccaReturn']['fieldFifteen'] : '' }}
                                                        </td>
                                                        <td></td>

                                                    </tr>
                                                @endforeach
                                            </tbody>
                                            <tfoot>
                                                <tr style="font-weight: bold;">
                                                    <td colspan="2">মোট</td>
                                                    <td></td>
                                                    <td>{{ $tableOneFieldFourTotal }}</td>
                                                    <td>{{ $tableOneFieldFiveTotal }}</td>
                                                    <td>{{ $tableOneFieldSixTotal }}</td>
                                                    <td>{{ $tableOneFieldSevenTotal }}</td>
                                                    <td>{{ $tableOneFieldEightTotal }}</td>
                                                    <td>{{ $tableOneFieldNineTotal }}</td>
                                                    <td>{{ $tableOneFieldTenTotal }}</td>
                                                    <td>{{ $tableOneFieldElevenTotal }}</td>
                                                    <td>{{ $tableOneFieldTwelveTotal }}</td>
                                                    <td>{{ $tableOneFieldThirteenTotal }}</td>
                                                    <td>{{ $tableOneFieldFourteenTotal }}</td>
                                                    <td>{{ $tableOneFieldFifteenTotal }}</td>
                                                    <td></td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                        @if ($divisionStatus == DIVISION_SUBMIT && get_return_has_submit_button_access($divisionStatus, UCCA_COOP_RETURN_ID))
                                            <div class="mb-3 mt-3">
                                                <label for="remarks" class="form-label">মন্তব্য</label>
                                                <textarea class="form-control" id="remarks" rows="3"></textarea>
                                            </div>
                                            <div class="d-grid gap-2 col-3 mt_30 mx-auto">
                                                <button class="btn_1 radius_btn d-block text-center" data-bs-toggle="modal"
                                                    data-bs-target="#confirmationModal">Submit</button>
                                            </div>
                                        @endif
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{-- submit modal --}}
        <div id="confirmationModal" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">নিশ্চিত !</h5>
                        <button type="button" class="close" data-bs-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body text-center">
                        <p class="text-black">তথ্য জমা দানে আপনি কি নিশ্চিত ?<br>(মনে রাখবেন - পরবর্তী সংশোধনে অনুমতির
                            প্রয়োজন হবে।)</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary submitBtnConfirm">Submit</button>
                    </div>
                </div>
            </div>
        </div>
        {{-- submit modal end --}}

        @foreach ($divisionsData as $id => $divisionData)
            @if (isset($divisionData['data']['uccaReturn']['remarks']))
                <div id="{{ 'divisionComment' . $id }}" class="modal">
                    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalCenteredScrollableTitle">মন্তব্য</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>{{ $divisionData['data']['uccaReturn']['remarks']['remarks'] }}</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            @endif
        @endforeach
    @endsection
    @push('extra-scripts')
        <script>
            $('#reportMonth').on('change', function() {
                location.href = '?month=' + $(this).val() + '&year=' + $('#reportYear').val();
            });
            $('#reportYear').on('change', function() {
                location.href = '?month=' + $('#reportMonth').val() + '&year=' + $(this).val();
            });

            $(".submitBtnConfirm").click(function() {
                var month = $('#reportMonth').val();
                var year = $('#reportYear').val();
                var remarks = $('#remarks').val() ? $('#remarks').val() : null;
                $.ajax({
                    type: "GET",
                    url: "{{ route('ucca-returns.department.submit') }}",
                    data: {
                        month,
                        year,
                        remarks
                    },
                    success: function(data) {
                        $("#confirmationModal").modal('hide');
                        window.location.reload();
                    },
                    error: function(error) {
                        if (error.responseJSON.status == false) {
                            // window.location.reload();
                        }
                    }
                });
            });
        </script>
    @endpush
</x-app-layout>
